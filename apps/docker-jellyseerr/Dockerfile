## This file is automatically generated (based on release.json)
##
## Do not changes any lines here
##
####################################
# All rights reserved.              #
# started from Zero                 #
# Docker owned dockserver           #
# Docker Maintainer dockserver      #
#####################################
#####################################
# THIS DOCKER IS UNDER LICENSE      #
# NO CUSTOMIZING IS ALLOWED         #
# NO REBRANDING IS ALLOWED          #
# NO CODE MIRRORING IS ALLOWED      #
#####################################
# shellcheck disable=SC2086
# shellcheck disable=SC2046
FROM ghcr.io/dockserver/docker-alpine-v3:latest

LABEL org.opencontainers.image.source="https://github.com/dockserver/container"
ARG TARGETPLATFORM
ARG BUILDPLATFORM

ARG VERSION="1.5.0"
ARG BRANCH=""
ENV HOME="/config"

RUN \
  echo "**** install packages ****" && \
    apk add -U --update --no-cache --virtual=build-dependencies curl g++ jq curl wget tar make python3 && \
  echo "**** symlink python3 for compatibility ****" && \
    ln -s /usr/bin/python3 /usr/bin/python && \
  echo "**** install runtime packages ****" && \
    apk add -U --update --no-cache yarn && \
    export COMMIT_TAG="v1.5.0" && \
  echo "**** install 'docker-jellyseerr' ****" && \
    mkdir -p /app/jellyseerr && \
    curl -fsSL "https://github.com/Fallenbagel/jellyseerr/archive/refs/tags/v${VERSION}.tar.gz" | tar xzf - -C /app/jellyseerr --strip-components=1 && \
    cd /app/jellyseerr && \
    export NODE_OPTIONS=--max_old_space_size=2048 && \
    yarn --frozen-lockfile --network-timeout 1000000 && \
    yarn build && yarn install --production --ignore-scripts --prefer-offline && \
    yarn cache clean && \
    rm -rf /app/overseerr/src /app/jellyseerr/server /app/jellyseerr/Dockerfile && \
  echo "{\"commitTag\": \"${COMMIT_TAG}\"}" > committag.json && \
    rm -rf /app/jellyseerr/config && \
    ln -s /config /app/jellyseerr/config && \
    touch /config/DOCKER && \
  echo "**** cleanup ****" && \
    apk del --purge build-dependencies && \
    rm -rf /root/.cache /tmp/* /app/jellyseerr/.next/cache/*

COPY --chown=abc ./apps/docker-jellyseerr/root/ /

EXPOSE 5055
VOLUME /config

##EOF
